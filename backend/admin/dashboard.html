<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Blog Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f6fa;
            color: #333;
            line-height: 1.6;
        }

        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 0;
            z-index: 1000;
            transition: transform 0.3s ease;
        }

        .sidebar.hidden {
            transform: translateX(-100%);
        }

        .sidebar-header {
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .sidebar-header h2 {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            opacity: 0.8;
            font-size: 14px;
        }

        .sidebar-nav {
            padding: 20px 0;
        }

        .nav-item {
            display: block;
            padding: 15px 20px;
            color: white;
            text-decoration: none;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background: rgba(255,255,255,0.1);
            border-left-color: #ff6b35;
        }

        .nav-item.active {
            background: rgba(255,255,255,0.15);
            border-left-color: #ff6b35;
        }

        .nav-item i {
            margin-right: 10px;
            width: 20px;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
        }

        .logout-btn {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
        }

        .main-content {
            margin-left: 250px;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }

        .main-content.expanded {
            margin-left: 0;
        }

        .topbar {
            background: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .topbar-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }

        .topbar-title {
            font-size: 24px;
            color: #2d5a87;
            font-weight: 600;
        }

        .topbar-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #666;
        }

        .user-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .content-area {
            padding: 30px;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 28px;
            color: #2d5a87;
            font-weight: 600;
        }

        .section-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid #667eea;
            color: #667eea;
        }

        .btn-outline:hover {
            background: #667eea;
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e1e5e9;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .stat-icon.posts {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stat-icon.views {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-icon.comments {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .stat-icon.subscribers {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            color: #2d5a87;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .data-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: 1px solid #e1e5e9;
        }

        .table-header {
            background: #f8f9fa;
            padding: 20px 30px;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
            color: #2d5a87;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .search-box {
            padding: 8px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            width: 200px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            text-align: left;
            padding: 15px 30px;
            border-bottom: 1px solid #e1e5e9;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2d5a87;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #666;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #2d5a87;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border-color: #bee5eb;
        }

        /* Post Editor Styles */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-group label {
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d5a87;
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group small {
            margin-top: 4px;
            color: #666;
            font-size: 12px;
        }

        .editor-toolbar {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px 8px 0 0;
            border: 2px solid #e1e5e9;
            border-bottom: none;
        }

        .editor-btn {
            padding: 8px 12px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
            min-width: 36px;
        }

        .editor-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .editor-toolbar + textarea {
            border-radius: 0 0 8px 8px;
            border-top: none;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid #e1e5e9;
        }

        .btn-loading {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-loading .spinner {
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top: 2px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Responsive form */
        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .form-actions {
                flex-direction: column;
            }
            
            .editor-toolbar {
                flex-wrap: wrap;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .menu-toggle {
                display: block;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .content-area {
                padding: 20px;
            }

            .topbar {
                padding: 15px 20px;
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .table-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .search-box {
                width: 100%;
            }

            th, td {
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2>üìä Admin</h2>
            <p>Blog Management</p>
        </div>
        
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" onclick="showSection('dashboard')">
                <i>üìà</i> Dashboard
            </a>
            <a href="#" class="nav-item" onclick="showSection('posts')">
                <i>üìù</i> Posts
            </a>
            <a href="#" class="nav-item" onclick="showSection('comments')">
                <i>üí¨</i> Comments
            </a>
            <a href="#" class="nav-item" onclick="showSection('subscribers')">
                <i>üìß</i> Newsletter
            </a>
            <a href="#" class="nav-item" onclick="showSection('analytics')">
                <i>üìä</i> Analytics
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <button class="logout-btn" onclick="logout()">
                <i>üö™</i> Logout
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Top Bar -->
        <div class="topbar">
            <div class="topbar-left">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1 class="topbar-title" id="pageTitle">Dashboard</h1>
            </div>
            <div class="topbar-right">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <span id="userName">Admin</span>
                </div>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Dashboard Section -->
            <div id="dashboard-section" class="content-section active">
                <div class="section-header">
                    <h2 class="section-title">Dashboard Overview</h2>
                    <div class="section-actions">
                        <button class="btn btn-outline" onclick="refreshDashboard()">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>

                <div id="stats-loading" class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading dashboard statistics...</p>
                </div>

                <div id="stats-grid" class="stats-grid" style="display: none;">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon posts">üìù</div>
                        </div>
                        <div class="stat-number" id="stat-posts">-</div>
                        <div class="stat-label">Total Posts</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon views">üëÅÔ∏è</div>
                        </div>
                        <div class="stat-number" id="stat-views">-</div>
                        <div class="stat-label">Total Views</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon comments">üí¨</div>
                        </div>
                        <div class="stat-number" id="stat-comments">-</div>
                        <div class="stat-label">Total Comments</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon subscribers">üìß</div>
                        </div>
                        <div class="stat-number" id="stat-subscribers">-</div>
                        <div class="stat-label">Newsletter Subscribers</div>
                    </div>
                </div>
            </div>

            <!-- Posts Section -->
            <div id="posts-section" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Posts Management</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="createPost()">
                            ‚ûï New Post
                        </button>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">All Posts</h3>
                        <div class="table-actions">
                            <input type="text" class="search-box" placeholder="Search posts..." id="posts-search">
                            <button class="btn btn-outline" onclick="loadPosts()">üîÑ</button>
                        </div>
                    </div>

                    <div id="posts-loading" class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading posts...</p>
                    </div>

                    <div id="posts-table" style="display: none;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Views</th>
                                    <th>Comments</th>
                                    <th>Published</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="posts-tbody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Comments Section -->
            <div id="comments-section" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Comments Moderation</h2>
                    <div class="section-actions">
                        <button class="btn btn-outline" onclick="loadComments()">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">Recent Comments</h3>
                        <div class="table-actions">
                            <input type="text" class="search-box" placeholder="Search comments..." id="comments-search">
                        </div>
                    </div>

                    <div id="comments-loading" class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading comments...</p>
                    </div>

                    <div id="comments-table" style="display: none;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Author</th>
                                    <th>Comment</th>
                                    <th>Post</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="comments-tbody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Newsletter Section -->
            <div id="subscribers-section" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Newsletter Management</h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" onclick="openNewsletterComposer()">
                            üìß Send Newsletter
                        </button>
                        <button class="btn btn-success" onclick="exportSubscribers()">
                            üì• Export CSV
                        </button>
                        <button class="btn btn-outline" onclick="loadSubscribers()">
                            üîÑ Refresh
                        </button>
                    </div>
                </div>

                <!-- Newsletter Stats -->
                <div class="stats-grid" style="margin-bottom: 30px;">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon subscribers">üìß</div>
                        </div>
                        <div class="stat-number" id="newsletter-subscribers">-</div>
                        <div class="stat-label">Active Subscribers</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon views">üìä</div>
                        </div>
                        <div class="stat-number" id="newsletter-sent">-</div>
                        <div class="stat-label">Newsletters Sent</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon comments">üìà</div>
                        </div>
                        <div class="stat-number" id="newsletter-opens">-</div>
                        <div class="stat-label">Open Rate</div>
                    </div>
                </div>

                <div class="data-table">
                    <div class="table-header">
                        <h3 class="table-title">All Subscribers</h3>
                        <div class="table-actions">
                            <input type="text" class="search-box" placeholder="Search subscribers..." id="subscribers-search">
                        </div>
                    </div>

                    <div id="subscribers-loading" class="loading">
                        <div class="loading-spinner"></div>
                        <p>Loading subscribers...</p>
                    </div>

                    <div id="subscribers-table" style="display: none;">
                        <table>
                            <thead>
                                <tr>
                                    <th>Email</th>
                                    <th>Status</th>
                                    <th>Source</th>
                                    <th>Subscribed</th>
                                </tr>
                            </thead>
                            <tbody id="subscribers-tbody">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analytics-section" class="content-section">
                <div class="section-header">
                    <h2 class="section-title">Analytics</h2>
                </div>
                
                <div class="alert alert-info">
                    <strong>Coming Soon!</strong> Advanced analytics and reporting features will be available in the next update.
                </div>
            </div>
        </div>
    </div>

    <!-- Newsletter Composer Modal -->
    <div id="newsletterComposerModal" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 95vh;">
            <div class="modal-header">
                <h3 class="modal-title">üìß Send Newsletter</h3>
                <button class="modal-close" onclick="closeNewsletterComposer()">&times;</button>
            </div>
            
            <form id="newsletterComposerForm">
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label for="newsletterSubject">Subject Line *</label>
                        <input type="text" id="newsletterSubject" name="subject" required placeholder="Enter newsletter subject">
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="newsletterTemplate">Quick Templates</label>
                        <select id="newsletterTemplate" onchange="loadNewsletterTemplate()">
                            <option value="">Select a template...</option>
                            <option value="welcome">Welcome Newsletter</option>
                            <option value="weekly">Weekly Digest</option>
                            <option value="announcement">Important Announcement</option>
                            <option value="product_update">Product Update</option>
                        </select>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="newsletterContent">Content *</label>
                        <div class="editor-toolbar">
                            <button type="button" class="editor-btn" onclick="insertNewsletterMarkdown('**', '**')" title="Bold">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="editor-btn" onclick="insertNewsletterMarkdown('*', '*')" title="Italic">
                                <em>I</em>
                            </button>
                            <button type="button" class="editor-btn" onclick="insertNewsletterMarkdown('## ', '')" title="Heading">
                                H2
                            </button>
                            <button type="button" class="editor-btn" onclick="insertNewsletterMarkdown('- ', '')" title="List">
                                ‚Ä¢
                            </button>
                            <button type="button" class="editor-btn" onclick="insertNewsletterMarkdown('[', '](url)')" title="Link">
                                üîó
                            </button>
                            <button type="button" class="editor-btn" onclick="previewNewsletter()" title="Preview">
                                üëÅÔ∏è
                            </button>
                        </div>
                        <textarea id="newsletterContent" name="content" required placeholder="Write your newsletter content in Markdown..." rows="12"></textarea>
                        <small>Use Markdown formatting. The content will be converted to HTML automatically.</small>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="testEmail">Test Email (Optional)</label>
                        <input type="email" id="testEmail" name="testEmail" placeholder="your@email.com">
                        <small>Send a test email to this address before sending to all subscribers</small>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closeNewsletterComposer()">Cancel</button>
                    <button type="button" class="btn btn-outline" onclick="sendTestNewsletter()">Send Test</button>
                    <button type="submit" class="btn btn-primary" id="sendNewsletterBtn">
                        <span id="sendNewsletterText">üìß Send to All Subscribers</span>
                        <div id="sendNewsletterLoading" class="btn-loading" style="display: none;">
                            <div class="spinner"></div>
                            <span>Sending...</span>
                        </div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Newsletter Preview Modal -->
    <div id="newsletterPreviewModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 class="modal-title">üìß Newsletter Preview</h3>
                <button class="modal-close" onclick="closeNewsletterPreview()">&times;</button>
            </div>
            <div id="newsletterPreviewContent" style="max-height: 70vh; overflow-y: auto; border: 1px solid #ddd; border-radius: 8px;">
                <!-- Preview content will be loaded here -->
            </div>
            <div class="form-actions">
                <button class="btn btn-outline" onclick="closeNewsletterPreview()">Close</button>
            </div>
        </div>
    </div>

    <!-- Post Editor Modal -->
    <div id="postEditorModal" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 95vh;">
            <div class="modal-header">
                <h3 class="modal-title" id="postEditorTitle">Create New Post</h3>
                <button class="modal-close" onclick="closePostEditor()">&times;</button>
            </div>
            
            <form id="postEditorForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="postTitle">Title *</label>
                        <input type="text" id="postTitle" name="title" required placeholder="Enter post title">
                    </div>
                    
                    <div class="form-group">
                        <label for="postSlug">Slug *</label>
                        <input type="text" id="postSlug" name="slug" required placeholder="post-url-slug">
                        <small>URL-friendly version of the title</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="postExcerpt">Excerpt *</label>
                        <textarea id="postExcerpt" name="excerpt" required placeholder="Brief description of the post" rows="3"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="postReadTime">Read Time</label>
                        <input type="text" id="postReadTime" name="readTime" placeholder="5 min read">
                    </div>
                    
                    <div class="form-group">
                        <label for="postFeaturedImage">Featured Image URL</label>
                        <input type="url" id="postFeaturedImage" name="featuredImage" placeholder="https://example.com/image.jpg">
                    </div>
                    
                    <div class="form-group">
                        <label for="postTags">Tags</label>
                        <input type="text" id="postTags" name="tags" placeholder="Tag1, Tag2, Tag3">
                        <small>Separate tags with commas</small>
                    </div>
                    
                    <div class="form-group full-width">
                        <label for="postContent">Content *</label>
                        <div class="editor-toolbar">
                            <button type="button" class="editor-btn" onclick="insertMarkdown('**', '**')" title="Bold">
                                <strong>B</strong>
                            </button>
                            <button type="button" class="editor-btn" onclick="insertMarkdown('*', '*')" title="Italic">
                                <em>I</em>
                            </button>
                            <button type="button" class="editor-btn" onclick="insertMarkdown('`', '`')" title="Code">
                                &lt;/&gt;
                            </button>
                            <button type="button" class="editor-btn" onclick="insertMarkdown('## ', '')" title="Heading">
                                H2
                            </button>
                            <button type="button" class="editor-btn" onclick="insertMarkdown('- ', '')" title="List">
                                ‚Ä¢
                            </button>
                            <button type="button" class="editor-btn" onclick="insertMarkdown('[', '](url)')" title="Link">
                                üîó
                            </button>
                            <button type="button" class="editor-btn" onclick="insertMarkdown('![alt](', ')')" title="Image">
                                üñºÔ∏è
                            </button>
                        </div>
                        <textarea id="postContent" name="content" required placeholder="Write your post content in Markdown..." rows="15"></textarea>
                        <small>Use Markdown formatting. Preview will be available in a future update.</small>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="closePostEditor()">Cancel</button>
                    <button type="button" class="btn btn-outline" onclick="saveAsDraft()">Save as Draft</button>
                    <button type="submit" class="btn btn-primary" id="publishPostBtn">
                        <span id="publishBtnText">Publish Post</span>
                        <div id="publishBtnLoading" class="btn-loading" style="display: none;">
                            <div class="spinner"></div>
                            <span>Publishing...</span>
                        </div>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Confirm Action</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div id="confirmMessage"></div>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-outline" onclick="closeModal()">Cancel</button>
                <button class="btn btn-danger" id="confirmButton">Confirm</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let authHeader = '';
        let currentSection = 'dashboard';
        let isMobile = window.innerWidth <= 768;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkAuth();
            setupEventListeners();
            setupPostEditor();
            loadDashboard();
        });

        // Check authentication
        function checkAuth() {
            const savedCredentials = localStorage.getItem('adminCredentials') || 
                                   sessionStorage.getItem('adminCredentials');
            
            if (!savedCredentials) {
                window.location.href = '/admin-login';
                return;
            }

            const credentials = JSON.parse(savedCredentials);
            authHeader = 'Basic ' + btoa(credentials.username + ':' + credentials.password);
            
            // Set user info
            document.getElementById('userName').textContent = credentials.username;
            document.getElementById('userAvatar').textContent = credentials.username.charAt(0).toUpperCase();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Responsive sidebar
            window.addEventListener('resize', function() {
                isMobile = window.innerWidth <= 768;
                if (!isMobile) {
                    document.getElementById('sidebar').classList.remove('active');
                }
            });

            // Search functionality
            document.getElementById('posts-search').addEventListener('input', function() {
                filterTable('posts-tbody', this.value);
            });

            document.getElementById('comments-search').addEventListener('input', function() {
                filterTable('comments-tbody', this.value);
            });

            document.getElementById('subscribers-search').addEventListener('input', function() {
                filterTable('subscribers-tbody', this.value);
            });
        }

        // Setup post editor
        function setupPostEditor() {
            // Auto-generate slug from title
            document.getElementById('postTitle').addEventListener('input', function() {
                if (!currentEditingSlug) { // Only auto-generate for new posts
                    const title = this.value;
                    const slug = title.toLowerCase()
                        .replace(/[^\w\s-]/g, '') // Remove special characters
                        .replace(/\s+/g, '-') // Replace spaces with hyphens
                        .replace(/--+/g, '-') // Replace multiple hyphens with single
                        .trim();
                    document.getElementById('postSlug').value = slug;
                }
            });

            // Post form submission
            document.getElementById('postEditorForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                await savePost();
            });

            // Close modal when clicking outside
            document.getElementById('postEditorModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closePostEditor();
                }
            });
        }

        // Navigation
        function showSection(section) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');

            // Hide all sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });

            // Show selected section
            document.getElementById(section + '-section').classList.add('active');

            // Update page title
            const titles = {
                dashboard: 'Dashboard',
                posts: 'Posts Management',
                comments: 'Comments Moderation',
                subscribers: 'Newsletter Subscribers',
                analytics: 'Analytics'
            };
            document.getElementById('pageTitle').textContent = titles[section];

            currentSection = section;

            // Load data for section
            switch(section) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'posts':
                    loadPosts();
                    break;
                case 'comments':
                    loadComments();
                    break;
                case 'subscribers':
                    loadSubscribers();
                    break;
            }

            // Close sidebar on mobile
            if (isMobile) {
                document.getElementById('sidebar').classList.remove('active');
            }
        }

        // Mobile menu toggle
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('active');
        }

        // API helper
        async function apiCall(endpoint, options = {}) {
            try {
                const response = await fetch(endpoint, {
                    headers: {
                        'Authorization': authHeader,
                        'Content-Type': 'application/json',
                        ...options.headers
                    },
                    ...options
                });

                if (response.status === 401) {
                    // Unauthorized, redirect to login
                    logout();
                    return;
                }

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                return response.json();
            } catch (error) {
                console.error('API call failed:', error);
                throw error;
            }
        }

        // Load dashboard
        async function loadDashboard() {
            try {
                const stats = await apiCall('/admin/dashboard');
                
                document.getElementById('stat-posts').textContent = stats.total_posts;
                document.getElementById('stat-views').textContent = stats.total_views.toLocaleString();
                document.getElementById('stat-comments').textContent = stats.total_comments;
                document.getElementById('stat-subscribers').textContent = stats.total_subscribers;
                
                document.getElementById('stats-loading').style.display = 'none';
                document.getElementById('stats-grid').style.display = 'grid';
            } catch (error) {
                document.getElementById('stats-loading').innerHTML = 
                    '<div class="alert alert-error">Failed to load dashboard: ' + error.message + '</div>';
            }
        }

        // Load posts
        async function loadPosts() {
            document.getElementById('posts-loading').style.display = 'block';
            document.getElementById('posts-table').style.display = 'none';

            try {
                const posts = await apiCall('/admin/posts?limit=50');
                
                const tbody = document.getElementById('posts-tbody');
                tbody.innerHTML = '';
                
                posts.forEach(post => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>
                            <strong>${post.title}</strong>
                            <br><small style="color: #666;">${post.excerpt.substring(0, 60)}...</small>
                        </td>
                        <td>${post.views}</td>
                        <td>-</td>
                        <td>${new Date(post.published_at).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-primary" onclick="editPost('${post.slug}')">Edit</button>
                            <button class="btn btn-danger" onclick="confirmDelete('post', '${post.slug}')">Delete</button>
                        </td>
                    `;
                });
                
                document.getElementById('posts-loading').style.display = 'none';
                document.getElementById('posts-table').style.display = 'block';
            } catch (error) {
                document.getElementById('posts-loading').innerHTML = 
                    '<div class="alert alert-error">Failed to load posts: ' + error.message + '</div>';
            }
        }

        // Load comments
        async function loadComments() {
            document.getElementById('comments-loading').style.display = 'block';
            document.getElementById('comments-table').style.display = 'none';

            try {
                const comments = await apiCall('/admin/comments?limit=100');
                
                const tbody = document.getElementById('comments-tbody');
                tbody.innerHTML = '';
                
                comments.forEach(comment => {
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>
                            <strong>${comment.author_name}</strong>
                            <br><small style="color: #666;">${comment.author_email}</small>
                        </td>
                        <td>${comment.body.substring(0, 80)}...</td>
                        <td>${comment.post_slug}</td>
                        <td>${new Date(comment.created_at).toLocaleDateString()}</td>
                        <td>
                            <button class="btn btn-danger" onclick="confirmDelete('comment', '${comment.id}')">Delete</button>
                        </td>
                    `;
                });
                
                document.getElementById('comments-loading').style.display = 'none';
                document.getElementById('comments-table').style.display = 'block';
            } catch (error) {
                document.getElementById('comments-loading').innerHTML = 
                    '<div class="alert alert-error">Failed to load comments: ' + error.message + '</div>';
            }
        }

        // Load subscribers
        async function loadSubscribers() {
            document.getElementById('subscribers-loading').style.display = 'block';
            document.getElementById('subscribers-table').style.display = 'none';

            try {
                const subscribers = await apiCall('/admin/subscribers?limit=200');
                
                const tbody = document.getElementById('subscribers-tbody');
                tbody.innerHTML = '';
                
                subscribers.forEach(subscriber => {
                    const row = tbody.insertRow();
                    const statusClass = subscriber.status === 'subscribed' ? 'status-active' : 'status-inactive';
                    row.innerHTML = `
                        <td>${subscriber.email}</td>
                        <td><span class="status-badge ${statusClass}">${subscriber.status}</span></td>
                        <td>${subscriber.source}</td>
                        <td>${new Date(subscriber.subscribed_at).toLocaleDateString()}</td>
                    `;
                });
                
                document.getElementById('subscribers-loading').style.display = 'none';
                document.getElementById('subscribers-table').style.display = 'block';
            } catch (error) {
                document.getElementById('subscribers-loading').innerHTML = 
                    '<div class="alert alert-error">Failed to load subscribers: ' + error.message + '</div>';
            }
        }

        // Filter table
        function filterTable(tbodyId, searchTerm) {
            const tbody = document.getElementById(tbodyId);
            const rows = tbody.getElementsByTagName('tr');
            
            for (let row of rows) {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm.toLowerCase()) ? '' : 'none';
            }
        }

        // Confirmation modal
        function confirmDelete(type, id) {
            const messages = {
                post: 'Are you sure you want to delete this post? This will also delete all associated comments.',
                comment: 'Are you sure you want to delete this comment?'
            };
            
            document.getElementById('confirmMessage').innerHTML = 
                '<p>' + messages[type] + '</p>';
            
            document.getElementById('confirmButton').onclick = function() {
                if (type === 'post') {
                    deletePost(id);
                } else {
                    deleteComment(id);
                }
                closeModal();
            };
            
            document.getElementById('confirmModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }

        // Delete functions
        async function deletePost(slug) {
            try {
                await apiCall(`/admin/posts/${slug}`, { method: 'DELETE' });
                showAlert('Post deleted successfully!', 'success');
                loadPosts();
            } catch (error) {
                showAlert('Failed to delete post: ' + error.message, 'error');
            }
        }

        async function deleteComment(id) {
            try {
                await apiCall(`/admin/comments/${id}`, { method: 'DELETE' });
                showAlert('Comment deleted successfully!', 'success');
                loadComments();
            } catch (error) {
                showAlert('Failed to delete comment: ' + error.message, 'error');
            }
        }

        // Export subscribers
        async function exportSubscribers() {
            try {
                const response = await fetch('/admin/subscribers/export', {
                    headers: {
                        'Authorization': authHeader
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Export failed');
                }
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'newsletter_subscribers.csv';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                showAlert('Subscribers exported successfully!', 'success');
            } catch (error) {
                showAlert('Failed to export subscribers: ' + error.message, 'error');
            }
        }

        // Utility functions
        function showAlert(message, type) {
            // Create alert element
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.position = 'fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '3000';
            alert.style.minWidth = '300px';
            
            document.body.appendChild(alert);
            
            // Remove after 5 seconds
            setTimeout(() => {
                document.body.removeChild(alert);
            }, 5000);
        }

        function refreshDashboard() {
            loadDashboard();
        }

        // Post Editor Functions
        let currentEditingSlug = null;

        function createPost() {
            currentEditingSlug = null;
            document.getElementById('postEditorTitle').textContent = 'Create New Post';
            document.getElementById('publishBtnText').textContent = 'Publish Post';
            clearPostForm();
            document.getElementById('postEditorModal').classList.add('active');
        }

        function editPost(slug) {
            currentEditingSlug = slug;
            document.getElementById('postEditorTitle').textContent = 'Edit Post';
            document.getElementById('publishBtnText').textContent = 'Update Post';
            loadPostForEditing(slug);
            document.getElementById('postEditorModal').classList.add('active');
        }

        function closePostEditor() {
            document.getElementById('postEditorModal').classList.remove('active');
            clearPostForm();
            currentEditingSlug = null;
        }

        function clearPostForm() {
            document.getElementById('postEditorForm').reset();
        }

        async function loadPostForEditing(slug) {
            try {
                const posts = await apiCall('/admin/posts?limit=100');
                const post = posts.find(p => p.slug === slug);
                
                if (post) {
                    document.getElementById('postTitle').value = post.title;
                    document.getElementById('postSlug').value = post.slug;
                    document.getElementById('postExcerpt').value = post.excerpt;
                    document.getElementById('postReadTime').value = post.read_time || '';
                    document.getElementById('postFeaturedImage').value = post.featured_image || '';
                    document.getElementById('postTags').value = Array.isArray(post.tags) ? post.tags.join(', ') : '';
                    document.getElementById('postContent').value = post.content;
                }
            } catch (error) {
                showAlert('Failed to load post: ' + error.message, 'error');
            }
        }

        // Auto-generate slug from title
        document.getElementById('postTitle').addEventListener('input', function() {
            if (!currentEditingSlug) { // Only auto-generate for new posts
                const title = this.value;
                const slug = title.toLowerCase()
                    .replace(/[^\w\s-]/g, '') // Remove special characters
                    .replace(/\s+/g, '-') // Replace spaces with hyphens
                    .replace(/--+/g, '-') // Replace multiple hyphens with single
                    .trim();
                document.getElementById('postSlug').value = slug;
            }
        });

        // Post form submission
        document.getElementById('postEditorForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await savePost();
        });

        async function savePost() {
            const form = document.getElementById('postEditorForm');
            const formData = new FormData(form);
            
            // Show loading state
            const publishBtn = document.getElementById('publishPostBtn');
            const publishBtnText = document.getElementById('publishBtnText');
            const publishBtnLoading = document.getElementById('publishBtnLoading');
            
            publishBtn.disabled = true;
            publishBtnText.style.display = 'none';
            publishBtnLoading.style.display = 'flex';

            try {
                const postData = {
                    title: formData.get('title'),
                    slug: formData.get('slug'),
                    excerpt: formData.get('excerpt'),
                    content: formData.get('content'),
                    read_time: formData.get('readTime') || '5 min read',
                    featured_image: formData.get('featuredImage') || '',
                    tags: formData.get('tags') ? formData.get('tags').split(',').map(tag => tag.trim()) : [],
                    images: [] // Can be extended for image management
                };

                let response;
                if (currentEditingSlug) {
                    // Update existing post
                    response = await apiCall(`/admin/posts/${currentEditingSlug}`, {
                        method: 'PUT',
                        body: JSON.stringify(postData)
                    });
                    showAlert('Post updated successfully!', 'success');
                } else {
                    // Create new post
                    response = await apiCall('/posts', {
                        method: 'POST',
                        body: JSON.stringify(postData)
                    });
                    showAlert('Post created successfully!', 'success');
                }

                closePostEditor();
                loadPosts(); // Refresh the posts list
                
            } catch (error) {
                showAlert('Failed to save post: ' + error.message, 'error');
            } finally {
                // Reset button state
                publishBtn.disabled = false;
                publishBtnText.style.display = 'inline';
                publishBtnLoading.style.display = 'none';
            }
        }

        async function saveAsDraft() {
            showAlert('Draft functionality coming soon!', 'info');
        }

        // Markdown editor helpers
        function insertMarkdown(before, after) {
            const textarea = document.getElementById('postContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            const newText = before + selectedText + after;
            textarea.value = textarea.value.substring(0, start) + newText + textarea.value.substring(end);
            
            // Set cursor position
            const newCursorPos = start + before.length + selectedText.length;
            textarea.setSelectionRange(newCursorPos, newCursorPos);
            textarea.focus();
        }

        // Close modal when clicking outside
        document.getElementById('postEditorModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePostEditor();
            }
        });

        // Newsletter Functions
        let newsletterTemplates = {};

        function openNewsletterComposer() {
            document.getElementById('newsletterComposerModal').classList.add('active');
            loadNewsletterTemplates();
        }

        function closeNewsletterComposer() {
            document.getElementById('newsletterComposerModal').classList.remove('active');
            document.getElementById('newsletterComposerForm').reset();
        }

        function closeNewsletterPreview() {
            document.getElementById('newsletterPreviewModal').classList.remove('active');
        }

        async function loadNewsletterTemplates() {
            try {
                const templates = await apiCall('/admin/newsletter/templates');
                newsletterTemplates = {};
                templates.forEach(template => {
                    newsletterTemplates[template.id] = template;
                });
            } catch (error) {
                console.error('Failed to load newsletter templates:', error);
            }
        }

        function loadNewsletterTemplate() {
            const templateId = document.getElementById('newsletterTemplate').value;
            if (templateId && newsletterTemplates[templateId]) {
                const template = newsletterTemplates[templateId];
                document.getElementById('newsletterSubject').value = template.subject;
                document.getElementById('newsletterContent').value = template.content;
            }
        }

        function insertNewsletterMarkdown(before, after) {
            const textarea = document.getElementById('newsletterContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            const newText = before + selectedText + after;
            textarea.value = textarea.value.substring(0, start) + newText + textarea.value.substring(end);
            
            const newCursorPos = start + before.length + selectedText.length;
            textarea.setSelectionRange(newCursorPos, newCursorPos);
            textarea.focus();
        }

        async function previewNewsletter() {
            const subject = document.getElementById('newsletterSubject').value;
            const content = document.getElementById('newsletterContent').value;

            if (!subject || !content) {
                showAlert('Please enter subject and content first', 'error');
                return;
            }

            try {
                const response = await apiCall('/admin/newsletter/preview', {
                    method: 'POST',
                    body: JSON.stringify({
                        subject: subject,
                        content: content
                    })
                });

                document.getElementById('newsletterPreviewContent').innerHTML = response.html_content;
                document.getElementById('newsletterPreviewModal').classList.add('active');
            } catch (error) {
                showAlert('Failed to generate preview: ' + error.message, 'error');
            }
        }

        async function sendTestNewsletter() {
            const testEmail = document.getElementById('testEmail').value;
            if (!testEmail) {
                showAlert('Please enter a test email address', 'error');
                return;
            }

            const subject = document.getElementById('newsletterSubject').value;
            const content = document.getElementById('newsletterContent').value;

            if (!subject || !content) {
                showAlert('Please enter subject and content first', 'error');
                return;
            }

            try {
                const response = await apiCall('/admin/newsletter/send', {
                    method: 'POST',
                    body: JSON.stringify({
                        subject: subject,
                        content: content,
                        test_email: testEmail
                    })
                });

                showAlert('Test newsletter sent successfully to ' + testEmail, 'success');
            } catch (error) {
                showAlert('Failed to send test newsletter: ' + error.message, 'error');
            }
        }

        // Newsletter form submission
        document.getElementById('newsletterComposerForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            await sendNewsletter();
        });

        async function sendNewsletter() {
            const subject = document.getElementById('newsletterSubject').value;
            const content = document.getElementById('newsletterContent').value;

            if (!subject || !content) {
                showAlert('Please enter subject and content', 'error');
                return;
            }

            // Confirm before sending
            if (!confirm('Are you sure you want to send this newsletter to all subscribers? This action cannot be undone.')) {
                return;
            }

            const sendBtn = document.getElementById('sendNewsletterBtn');
            const sendText = document.getElementById('sendNewsletterText');
            const sendLoading = document.getElementById('sendNewsletterLoading');

            sendBtn.disabled = true;
            sendText.style.display = 'none';
            sendLoading.style.display = 'flex';

            try {
                const response = await apiCall('/admin/newsletter/send', {
                    method: 'POST',
                    body: JSON.stringify({
                        subject: subject,
                        content: content
                    })
                });

                showAlert(`Newsletter sent successfully to ${response.recipient_count} subscribers!`, 'success');
                closeNewsletterComposer();
                loadNewsletterStats();
            } catch (error) {
                showAlert('Failed to send newsletter: ' + error.message, 'error');
            } finally {
                sendBtn.disabled = false;
                sendText.style.display = 'inline';
                sendLoading.style.display = 'none';
            }
        }

        async function loadNewsletterStats() {
            try {
                const stats = await apiCall('/admin/newsletter/stats');
                document.getElementById('newsletter-subscribers').textContent = stats.total_subscribers;
                document.getElementById('newsletter-sent').textContent = stats.total_sent;
                document.getElementById('newsletter-opens').textContent = stats.open_rate || '0%';
            } catch (error) {
                console.error('Failed to load newsletter stats:', error);
            }
        }

        function logout() {
            localStorage.removeItem('adminCredentials');
            sessionStorage.removeItem('adminCredentials');
            window.location.href = '/admin-login';
        }
    </script>
</body>
</html> 